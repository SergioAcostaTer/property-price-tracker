{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.propprice.dev/acq.job.dispatched.v1.schema.json",
  "type": "object",
  "required": ["schema_version", "event_id", "occurred_at", "job", "request"],
  "properties": {
    "schema_version": { "const": 1 },
    "event_id": { "type": "string", "format": "uuid" },
    "occurred_at": { "type": "string", "format": "date-time" },
    "job": {
      "type": "object",
      "required": ["job_id", "portal", "task_type", "segment", "priority"],
      "properties": {
        "job_id": { "type": "string", "format": "uuid" },
        "portal": { "type": "string", "minLength": 1 },
        "task_type": { "type": "string", "enum": ["search_page", "detail"] },
        "segment": {
          "type": "string",
          "enum": ["unknown", "sale", "rent", "short_term", "room", "commercial", "land"]
        },
        "priority": { "type": "integer", "minimum": 1, "maximum": 9 }
      },
      "additionalProperties": false
    },
    "request": {
      "type": "object",
      "required": ["url", "url_hash", "attempt"],
      "properties": {
        "url": { "type": "string", "minLength": 10 },
        "url_hash": { "type": "string", "pattern": "^[0-9a-f]{32}$" },
        "attempt": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
